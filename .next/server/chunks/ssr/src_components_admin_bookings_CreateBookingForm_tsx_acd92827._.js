module.exports=[94568,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(38246),f=a.i(14548),g=a.i(96221),h=a.i(41675),i=a.i(11156),j=a.i(46842),k=a.i(97063),l=a.i(38632),m=a.i(56711),n=a.i(93901),o=a.i(99570),p=a.i(66718),q=a.i(70430),r=a.i(63658),s=a.i(91119),t=a.i(80701),u=a.i(99209),v=a.i(20146),w=a.i(68114),x=a.i(28337),y=a.i(23292);function z(){let a,z=(0,d.useSearchParams)().get("date"),{isSaving:A,lapangans:B,users:C,paymentMethods:D,statuses:E,isManualBooking:F,setIsManualBooking:G,formData:H,setFormData:I,getJamSelesai:J,getEstimasiHarga:K,handleSubmit:L,getBookedDates:M,isTimeSlotBooked:N,maxDuration:O,isTimePassed:P}=function(){let a=(0,d.useRouter)(),[b,e]=(0,c.useState)(!1),[f,g]=(0,c.useState)([]),[h,i]=(0,c.useState)([]),[j,k]=(0,c.useState)([]),[l,n]=(0,c.useState)([]),[o,p]=(0,c.useState)([]),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(12),[u,v]=(0,c.useState)({buka:6,tutup:23}),[w,z]=(0,c.useState)({nama_pengirim:"",user_id:"",acara:"",tanggal_booking:void 0,lapangan_id:"",jam_mulai:"",durasi_jam:"1",payment_method_id:"",status_booking_id:"1",jumlah_dp:"",asal_bank:"",bukti_pembayaran:null});(0,c.useEffect)(()=>{(async()=>{try{let[a,b,c,d,e]=await Promise.all([x.default.get("/api/lapangans"),x.default.get("/api/users"),x.default.get("/api/paymentMethods"),x.default.get("/api/statusBookings"),x.default.get("/api/bookings")]),f=a=>{let b=a.data?.data||a.data;return Array.isArray(b)?b:[]},h=f(a);g(h);let j=f(b).filter(a=>{if(!a)return!1;let b=2===a.role_id,c=a.role?.name_role?.toLowerCase()==="pelanggan"||a.role?.name?.toLowerCase()==="pelanggan";return b||c});i(j);let l=f(c);if(k(l.filter(a=>a?.is_aktif)),n(f(d)),p(f(e)),h.length>0){let a=h[0];z(b=>({...b,lapangan_id:String(a.id)})),a.jam_buka&&a.jam_tutup&&v({buka:parseInt(a.jam_buka.split(":")[0]),tutup:parseInt(a.jam_tutup.split(":")[0])})}}catch(a){console.error("init create booking form",a),y.toast.error(a?.response?.data?.message||"Gagal memuat data form booking.")}})()},[]),(0,c.useEffect)(()=>{let a=Array.isArray(f)?f:[];if(w.lapangan_id&&a.length>0){let b=a.find(a=>String(a.id)===String(w.lapangan_id));b&&b.jam_buka&&b.jam_tutup&&v({buka:parseInt(b.jam_buka.split(":")[0]),tutup:parseInt(b.jam_tutup.split(":")[0])})}},[w.lapangan_id,f]),(0,c.useEffect)(()=>{if(!w.jam_mulai||!w.tanggal_booking||!w.lapangan_id)return void t(5);let a=(0,m.format)(w.tanggal_booking,"yyyy-MM-dd"),b=parseInt(w.jam_mulai.split(":")[0]),c=parseInt(String(w.lapangan_id)),d=(Array.isArray(o)?o:[]).filter(d=>d?.tanggal_booking===a&&d?.status_booking_id!==4&&d?.lapangan_id===c&&parseInt(d.jam_mulai.split(":")[0])>b).sort((a,b)=>parseInt(a.jam_mulai)-parseInt(b.jam_mulai)),e=u.tutup,f=0;t(f=Math.max(1,Math.min(f=d.length>0?parseInt(d[0].jam_mulai.split(":")[0])-b:e-b,12))),parseInt(w.durasi_jam)>f&&z(a=>({...a,durasi_jam:String(f)}))},[w.jam_mulai,w.tanggal_booking,w.lapangan_id,o,u]);let A=a=>{if(!w.tanggal_booking||!w.lapangan_id)return!1;let b=(0,m.format)(w.tanggal_booking,"yyyy-MM-dd"),c=parseInt(String(w.lapangan_id)),[d]=a.split(":").map(Number);return(Array.isArray(o)?o:[]).some(a=>{let e;if(!a||!a.tanggal_booking||!a.jam_mulai||a.tanggal_booking!==b||a.lapangan_id!==c||4===a.status_booking_id)return!1;let[f]=a.jam_mulai.split(":").map(Number);return e=a.jam_selesai?parseInt(a.jam_selesai.split(":")[0]):f+(a.durasi_jam?Number(a.durasi_jam):1),d>=f&&d<e})},B=async()=>{if(!w.lapangan_id||!w.tanggal_booking||!w.jam_mulai)return y.toast.error("Isi semua field jadwal (lapangan, tanggal, jam mulai).");if(q){if(!w.nama_pengirim)return y.toast.error("Isi nama pelanggan untuk booking manual.")}else if(!w.user_id)return y.toast.error("Pilih member / user untuk booking.");if(A(w.jam_mulai))return y.toast.error("Jam yang dipilih sudah terisi. Silakan pilih jam lain.");e(!0);try{let b={lapangan_id:parseInt(String(w.lapangan_id)),tanggal_booking:(0,m.format)(w.tanggal_booking,"yyyy-MM-dd"),jam_mulai:w.jam_mulai,durasi_jam:parseInt(String(w.durasi_jam||"1")),payment_method_id:w.payment_method_id?parseInt(String(w.payment_method_id)):void 0,acara:w.acara||void 0,asal_bank:w.asal_bank||void 0,nama_pengirim:w.nama_pengirim||void 0,jumlah_dp:w.jumlah_dp?parseInt(String(w.jumlah_dp)):void 0,status_booking_id:w.status_booking_id?parseInt(String(w.status_booking_id)):1};!q&&w.user_id&&(b.user_id=parseInt(String(w.user_id)));let c=await x.default.post("/api/bookings",b),d=c.data?.data?.id||c.data.id;if(w.bukti_pembayaran){let a=new FormData;a.append("bukti_pembayaran",w.bukti_pembayaran),w.jumlah_dp&&a.append("jumlah_dp",w.jumlah_dp),await x.default.post(`/api/bookings/${d}/payment`,a)}w.status_booking_id&&"1"!==String(w.status_booking_id)&&"2"!==String(w.status_booking_id)&&await x.default.patch(`/api/bookings/${d}/status`,{status_booking_id:parseInt(String(w.status_booking_id))}),y.toast.success("Booking berhasil dibuat."),a.push("/admin/bookings")}catch(c){let a=c.response?.status,b=c.response?.data;if(422===a&&b?.errors){let a=Object.values(b.errors),c=a?.[0]?.[0];y.toast.error(c||b.message||"Validasi gagal.")}else y.toast.error(b?.message||"Gagal menyimpan booking.")}finally{e(!1)}};return{isSaving:b,lapangans:f,users:h,paymentMethods:j,statuses:l,isManualBooking:q,setIsManualBooking:r,formData:w,setFormData:z,getJamSelesai:()=>{if(!w.jam_mulai)return"--:--";let[a,b]=(w.jam_mulai||"").split(":").map(Number),c=a+Number(w.durasi_jam||0);return`${String(c).padStart(2,"0")}:${String(b||0).padStart(2,"0")}`},getEstimasiHarga:()=>{let a=(Array.isArray(f)?f:[]).find(a=>String(a.id)===String(w.lapangan_id));return(a?Number(a.harga_per_jam||0):0)*Number(w.durasi_jam||0)},handleSubmit:B,getBookedDates:()=>(Array.isArray(o)?o:[]).filter(a=>a?.status_booking_id!==4&&a?.tanggal_booking).map(a=>new Date(a.tanggal_booking)),isTimeSlotBooked:A,maxDuration:s,isTimePassed:a=>{if(!w.tanggal_booking)return!1;let b=new Date,c=new Date(w.tanggal_booking);if(b.getDate()===c.getDate()&&b.getMonth()===c.getMonth()&&b.getFullYear()===c.getFullYear()){let[c]=a.split(":").map(Number);return c<=b.getHours()}return!1},jamOperasional:u}}(),[Q,R]=(0,c.useState)({buka:6,tutup:23});(0,c.useEffect)(()=>{if(z&&!H.tanggal_booking)try{let[a,b,c]=z.split("-").map(Number),d=new Date(a,b-1,c);isNaN(d.getTime())||I(a=>({...a,tanggal_booking:d}))}catch(a){console.error("Failed to parse date from URL:",a)}},[z]),(0,c.useEffect)(()=>{if(H.lapangan_id&&B.length>0){let a=B.find(a=>String(a.id)===H.lapangan_id);a&&a.jam_buka&&a.jam_tutup&&R({buka:parseInt(a.jam_buka.split(":")[0]),tutup:parseInt(a.jam_tutup.split(":")[0])})}},[H.lapangan_id,B]);let S=Array.from({length:Q.tutup-Q.buka},(a,b)=>{let c=b+Q.buka;return`${String(c).padStart(2,"0")}:00`}),T=E.find(a=>"terkonfirmasi"===a.nama_status.toLowerCase()),U=T?String(T.id):"3";return(0,c.useEffect)(()=>{("1"===H.status_booking_id||""===H.status_booking_id)&&I(a=>({...a,status_booking_id:U}))},[U,H.status_booking_id,I]),(0,b.jsxs)("form",{onSubmit:a=>{a.preventDefault(),L()},className:"space-y-6",children:[(0,b.jsxs)(s.Card,{children:[(0,b.jsx)(s.CardHeader,{className:"pb-3 border-b mb-4",children:(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsxs)(s.CardTitle,{className:"text-base flex items-center gap-2",children:[(0,b.jsx)(j.User,{className:"w-4 h-4"})," Informasi Penyewa"]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2 bg-gray-50 px-3 py-1.5 rounded-full border",children:[(0,b.jsx)(q.Label,{htmlFor:"mode-manual",className:"text-xs cursor-pointer font-medium text-gray-600",children:F?"Mode Tamu (Walk-in)":"Mode Member"}),(0,b.jsx)(r.Switch,{id:"mode-manual",checked:F,onCheckedChange:G})]})]})}),(0,b.jsxs)(s.CardContent,{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[F?(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(q.Label,{children:["Nama Pelanggan (Manual) ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsx)(p.Input,{placeholder:"Cth: Pak Budi (Umum)",value:H.nama_pengirim,onChange:a=>I({...H,nama_pengirim:a.target.value}),className:"bg-yellow-50 border-yellow-200 focus:border-yellow-400"}),(0,b.jsx)("p",{className:"text-[10px] text-gray-500",children:"Nama ini akan dicatat sebagai penyewa."})]}):(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(q.Label,{children:["Pilih Member ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsxs)(t.Select,{value:H.user_id?String(H.user_id):void 0,onValueChange:a=>I({...H,user_id:a}),children:[(0,b.jsx)(t.SelectTrigger,{children:(0,b.jsx)(t.SelectValue,{placeholder:"Cari nama member..."})}),(0,b.jsx)(t.SelectContent,{children:C.map(a=>(0,b.jsxs)(t.SelectItem,{value:a.id.toString(),children:[a.name," (",a.nomor_telepon||"-",")"]},a.id))})]}),(0,b.jsxs)("p",{className:"text-[10px] text-gray-500",children:[(0,b.jsx)(e.default,{href:"/admin/users",className:"text-blue-600 hover:underline",children:"Tambah User Baru"})," jika belum terdaftar."]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(q.Label,{children:"Nama Kegiatan / Club"}),(0,b.jsx)(p.Input,{placeholder:"Cth: Latihan Rutin, Turnamen Kecil",value:H.acara,onChange:a=>I({...H,acara:a.target.value})})]})]})]}),(0,b.jsxs)(s.Card,{children:[(0,b.jsx)(s.CardHeader,{className:"pb-3 border-b mb-4",children:(0,b.jsxs)(s.CardTitle,{className:"text-base flex items-center gap-2",children:[(0,b.jsx)(h.Calendar,{className:"w-4 h-4"})," Jadwal Main"]})}),(0,b.jsxs)(s.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(q.Label,{children:["Pilih Lapangan ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsxs)(t.Select,{value:H.lapangan_id,onValueChange:a=>I({...H,lapangan_id:a}),children:[(0,b.jsx)(t.SelectTrigger,{children:(0,b.jsx)(t.SelectValue,{placeholder:"Pilih Lapangan"})}),(0,b.jsx)(t.SelectContent,{children:B.map(a=>(0,b.jsx)(t.SelectItem,{value:a.id.toString(),children:a.nama_lapangan},a.id))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(q.Label,{children:["Tanggal Main ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsxs)(u.Popover,{children:[(0,b.jsx)(u.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)(o.Button,{variant:"outline",className:(0,w.cn)("w-full justify-start text-left font-normal",!H.tanggal_booking&&"text-muted-foreground"),children:[(0,b.jsx)(h.Calendar,{className:"mr-2 h-4 w-4"}),H.tanggal_booking?(0,m.format)(H.tanggal_booking,"PPP",{locale:n.id}):(0,b.jsx)("span",{children:"Pilih tanggal"})]})}),(0,b.jsx)(u.PopoverContent,{className:"w-auto p-0",align:"start",children:(0,b.jsx)(v.Calendar,{mode:"single",selected:H.tanggal_booking,onSelect:a=>I({...H,tanggal_booking:a}),initialFocus:!0,disabled:a=>a<new Date(new Date().setHours(0,0,0,0)),modifiers:{booked:M()},modifiersStyles:{booked:{textDecoration:"underline",color:"#D93F21",fontWeight:"bold"}}})})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsxs)(q.Label,{children:["Jam Mulai ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),H.lapangan_id&&(0,b.jsxs)("span",{className:"text-[10px] text-gray-500 bg-gray-100 px-2 py-0.5 rounded",children:["Buka: ",Q.buka,":00 - ",Q.tutup,":00"]})]}),(0,b.jsxs)(t.Select,{value:H.jam_mulai,onValueChange:a=>I({...H,jam_mulai:a}),disabled:!H.tanggal_booking||!H.lapangan_id,children:[(0,b.jsx)(t.SelectTrigger,{children:(0,b.jsx)(t.SelectValue,{placeholder:"Pilih Jam"})}),(0,b.jsx)(t.SelectContent,{className:"max-h-[200px]",children:S.length>0?S.map(a=>{let c=N(a),d=P(a),e=c||d;return(0,b.jsxs)(t.SelectItem,{value:a,disabled:e,className:e?"text-gray-400 bg-gray-50 cursor-not-allowed opacity-50":"",children:[a,c&&" (Terisi)",d&&!c&&" (Lewat)"]},a)}):(0,b.jsx)("div",{className:"p-2 text-sm text-gray-500 text-center",children:"Pilih lapangan dahulu"})})]}),!H.tanggal_booking&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Pilih tanggal & lapangan dulu."})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)(q.Label,{children:"Durasi (Jam)"}),H.jam_mulai&&(0,b.jsxs)("span",{className:"text-[10px] text-orange-600 font-bold",children:["Max: ",O," Jam"]})]}),(0,b.jsx)(p.Input,{type:"number",min:"1",max:O,value:H.durasi_jam,onChange:a=>{let b=parseInt(a.target.value);isNaN(b)&&(b=1),b>O&&(b=O),b<1&&(b=1),I({...H,durasi_jam:String(b)})},disabled:!H.jam_mulai}),parseInt(H.durasi_jam)===O&&H.jam_mulai&&(0,b.jsx)("p",{className:"text-[10px]  italic text-red-500",children:"* Mentok karena ada booking lain atau jam tutup."})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(q.Label,{children:"Jam Selesai (Est)"}),(0,b.jsx)(p.Input,{value:J(),disabled:!0,className:"bg-gray-100"})]})]})]})]}),(0,b.jsxs)(s.Card,{className:"border-l-4 border-l-[#D93F21]",children:[(0,b.jsx)(s.CardHeader,{className:"pb-3 border-b mb-4",children:(0,b.jsxs)(s.CardTitle,{className:"text-base flex items-center gap-2",children:[(0,b.jsx)(i.CreditCard,{className:"w-4 h-4"})," Pembayaran & Status"]})}),(0,b.jsxs)(s.CardContent,{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center bg-gray-50 p-4 rounded-lg border border-gray-200",children:[(0,b.jsx)("span",{className:"text-gray-600 font-medium",children:"Total Harga Sewa"}),(0,b.jsx)("span",{className:"text-2xl font-bold text-[#D93F21]",children:(a=K(),new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a))})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(q.Label,{children:["Metode Pembayaran ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsxs)(t.Select,{value:H.payment_method_id?String(H.payment_method_id):void 0,onValueChange:a=>I({...H,payment_method_id:a}),children:[(0,b.jsx)(t.SelectTrigger,{children:(0,b.jsx)(t.SelectValue,{placeholder:"Pilih Metode"})}),(0,b.jsx)(t.SelectContent,{children:D.map(a=>(0,b.jsx)(t.SelectItem,{value:a.id.toString(),children:a.nama_metode},a.id))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(q.Label,{children:"Jumlah Bayar / DP (Rp)"}),(0,b.jsx)(p.Input,{type:"text",placeholder:"0",value:H.jumlah_dp,onChange:a=>I({...H,jumlah_dp:a.target.value})}),(0,b.jsx)("p",{className:"text-[10px] text-gray-500",children:"Jika lunas, isi sesuai total tagihan."})]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(q.Label,{children:["Status Booking ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsxs)(t.Select,{value:H.status_booking_id,onValueChange:a=>I({...H,status_booking_id:a}),disabled:!0,children:[(0,b.jsx)(t.SelectTrigger,{className:"font-bold text-green-700 bg-green-50 border-green-200",children:(0,b.jsx)(t.SelectValue,{placeholder:"Pilih Status"})}),(0,b.jsx)(t.SelectContent,{children:(0,b.jsx)(t.SelectItem,{value:U,children:T?T.nama_status:"Terkonfirmasi"})})]}),(0,b.jsxs)("div",{className:"flex gap-2 items-start bg-yellow-50 p-2 rounded text-[11px] text-yellow-700 mt-1",children:[(0,b.jsx)(k.Info,{className:"w-3 h-3 mt-0.5"}),(0,b.jsxs)("p",{children:["Booking manual otomatis dianggap ",(0,b.jsx)("b",{children:'"Terkonfirmasi"'})," agar tercatat di Laporan Keuangan."]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(q.Label,{children:"Asal Bank / Keterangan (Opsional)"}),(0,b.jsx)(p.Input,{placeholder:"Cth: Cash Tunai",value:H.asal_bank,onChange:a=>I({...H,asal_bank:a.target.value})})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(q.Label,{children:"Upload Bukti (Opsional)"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(p.Input,{type:"file",accept:"image/*",onChange:a=>{a.target.files&&a.target.files[0]&&I({...H,bukti_pembayaran:a.target.files[0]})},className:"pl-10 cursor-pointer"}),(0,b.jsx)(l.Image,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]})]})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,b.jsx)(e.default,{href:"/admin/bookings",children:(0,b.jsx)(o.Button,{variant:"outline",type:"button",className:"h-12 px-8 text-base font-semibold",children:"Batal"})}),(0,b.jsxs)(o.Button,{type:"submit",disabled:A,className:"bg-[#D93F21] hover:bg-[#b9351b] h-12 px-8 text-base font-bold shadow-md",children:[A?(0,b.jsx)(g.Loader2,{className:"h-4 w-4 animate-spin mr-2"}):(0,b.jsx)(f.Save,{className:"h-4 w-4 mr-2"}),"Simpan Booking"]})]})]})}a.s(["default",()=>z],94568)}];

//# sourceMappingURL=src_components_admin_bookings_CreateBookingForm_tsx_acd92827._.js.map